<!DOCTYPE html>
<html>
    
<head>
    <title>Lucky Penny Roast Lab</title>
    <link rel="icon" type="image/x-icon" href="/static/US_One_Cent_Obv.png">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Rock+Salt&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-wrapper" align="center">
    <h1 class="rock-salt-regular">Lucky Penny Roast Lab</h1>
    <div align="center">
        <table style="width: 80%;" cellpadding="0" align="center">
                <tr align="center">
                    <a href="/" style="color: white;"><img src="static/lprl-banner-1.png"></a></td>
                    <a href="/recordRoast" style="color: white;"><img src="static/lprl-banner-2.png"></a>
                    <a href="/drinkLibrary" style="color: white;"><img src="static/lprl-banner-3.png"></a>
                    <a href="/recordDrink" style="color: white;"><img src="static/lprl-banner-4.png"></a>
                </tr>
        </table>
    </div>
    
    <div class="inner-content" align="center">
        <h2 class="cutive-mono-regular" style="font-size:32px" align="center">Create New Roast</h2>

        <form action="/submitRoast" method="POST" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; margin-top: 20px;">
            <div style="display: flex; flex-direction: row; align-items: flex-start; gap: 40px">
                <div style="display: flex; flex-direction: column; align-items: flex-start">
                    <label style="display: block; text-align: left; margin-bottom: 5px;" for="date">Date:</label>
                    <input type="date" id="date" name="date" pattern="\d{4}-\d{2}-\d{2}" placeholder="YYYY-MM-DD" required style="width: 180px; height: 26px; border-radius: 8px; padding: 10px; border: 1px solid #aaa; font-size: 16px">
                </div>
                <div>
                    <label style="display: block; text-align: left;" for="country">Origin:</label>
                    <select id="country" name="country" required style="width: 201.6px; height: 48px; border-radius: 8px; padding: 10px; border: 1px solid #aaa;">
                        <option value="" disabled selected hidden></option>
                        <option value="Ethiopia">Ethiopia</option>
                        <option value="Kenya">Kenya</option>
                        </select>
                </div>
                <div>
                    <label style="display: block; text-align: left;" for="farm">Farm:</label>
                    <input type="text" id="farm" name="farm" class="lprl-text-input" required style="width: 180px;">
                </div>
            </div>
            <div style="display: flex; flex-direction: row; align-items: flex-start; gap: 40px">
                <div>
                    <label style="display: block; text-align: left;" for="roaster">Roaster:</label>
                    <select id="roaster" name="roaster" class="lprl-dropdown" required style="width: 201.6px">
                        <option value="Popper">Popper</option>
                        </select>
                </div>
                <div>
                    <label style="display: block; text-align: left;" for="roast">Roast Level:</label>
                    <select id="roast" name="roast" class="lprl-dropdown" required style="width: 201.6px">
                        <option value="" disabled selected hidden></option>
                        <option value="City-">City-</option>
                        <option value="City">City</option>
                        <option value="City+">City+</option>
                        <option value="Full City">Full City</option>
                        <option value="Full City+">Full City+</option>
                        <option value="French">French</option>
                        </select>
                </div>
                <div>
                    <label style="display: block; text-align: left;" for="duration">Duration:</label>
                    <input type="text" id="duration" name="duration" pattern="[0-9]{1,3}:[0-5][0-9]" placeholder="MM:SS" class="lprl-text-input" required style="width: 180px">
                </div>
            </div>
            <div style="display: flex; flex-direction: row; align-items: flex-start; gap: 40px">
                <div>
                    <label style="display: block; text-align: left; margin-bottom: 5px;" for="mass_in">Mass In:</label>
                    <input type="number" step="any" id="mass_in" name="mass_in" class="lprl-text-input" required style="width: 180px">
                </div>
                <div>
                    <label style="display: block; text-align: left; margin-bottom: 5px;" for="mass_out">Mass Out:</label>
                    <input type="number" step="any" id="mass_out" name="mass_out" class="lprl-text-input" required style="width: 180px">
                </div>
                <div>
                    <label style="display: block; text-align: left; margin-bottom: 5px;" for="loss">Loss:</label>
                    <input type="number" step="any" id="loss" name="loss" class="lprl-text-input" readonly style="width: 180px">
                </div>
            </div>
            <div style="display: flex; flex-direction: row; align-items: flex-start; gap: 40px">
                <div>
                    <label style="display: block; text-align: left; margin-bottom: 5px;" for="profile">Profile:</label>
                    <input type="text" id="profile" name="profile" class="lprl-text-input" required readonly style="width: 421.6px">
                </div>
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <label for="customProfileName" style="margin-left: 8px; margin-bottom: 10px; margin-right: 134.27px">Custom:</label>
                    <label class="switch">
                        <input type="checkbox" id="customProfileName" onchange="toggleProfileReadonly()">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
                
            <button class="button-55" type="submit">Record Roast</button>
        </form>
    </div>
    
    </div>
</body>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Define variables
        const massIn = document.getElementById('mass_in');
        const massOut = document.getElementById('mass_out');
        const loss = document.getElementById('loss');
        
        const dateInput = document.getElementById('date');
        const countryInput = document.getElementById('country');
        const farmInput = document.getElementById('farm');
        const profileInput = document.getElementById('profile');

        const customProfileToggle = document.getElementById('customProfileName');

            // Define function that calculates roast loss
            function calculateLoss() {
                const inVal = parseFloat(massIn.value) || 0;
                const outVal = parseFloat(massOut.value) || 0;
                const calculatedLoss = (inVal - outVal) / inVal * 100;
                loss.value = calculatedLoss.toFixed(1);
            }
            
            // Define function to generate and set the profile name
            function generateProfileName() {
                // Sample and formant values
                const dateValue = dateInput.value;
                const country = countryInput.value.trim().replace(/\s+/g, '');
                const farm = farmInput.value.trim().replace(/\s+/g, '');
                
                let formattedDate = '';
                if (dateValue) {
                    // Split the date string (e.g., "2025-07-22") into parts
                    const [year, month, day] = dateValue.split('-');
                    
                    // Array of 3-letter month abbreviations
                    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                        "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    
                    // Get the month abbreviation (month is 1-indexed, so subtract 1 for array index)
                    const monthAbbr = monthNames[parseInt(month, 10) - 1];
                    
                    // Format as ddmmmyyyy
                    formattedDate = `${day}${monthAbbr}${year}`; // e.g., "22Jul2025"
                }
                
                if (formattedDate && country && farm) {
                    profileInput.value = `${country}${farm}_${formattedDate}.png`;
                } else {
                    profileInput.value = '';
                }
            }
            
            function toggleProfileReadonly() {
                if (customProfileToggle.checked) {
                    // If "Custom" is checked, remove readonly to allow manual entry
                    profileInput.readOnly = false;
                    profileInput.focus(); // Optional: put focus on the input for immediate typing
                } else {
                    // If "Custom" is unchecked, make it readonly again
                    profileInput.readOnly = true;
                    // And regenerate the auto-profile value immediately
                    generateProfileName(); 
                }
            }

        // Listening events
        massOut.addEventListener('input', calculateLoss);
        if (farmInput) farmInput.addEventListener('input', generateProfileName);
        if (customProfileToggle) customProfileToggle.addEventListener('change', toggleProfileReadonly);
        
        generateProfileName();
        toggleProfileReadonly();
    });
</script>

</html>
